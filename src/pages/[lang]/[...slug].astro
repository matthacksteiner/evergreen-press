---
import {
	getLanguages,
	getGlobal,
	getAllPages,
	getData,
	type GlobalData,
} from '@lib/api';
import PageRenderer from '@components/PageRenderer.astro';

export async function getStaticPaths() {
	const global = await getGlobal();
	const prefixDefaultLocale = global.prefixDefaultLocale;
	const languages = await getLanguages();
	const allLang = !prefixDefaultLocale
		? languages.translations.map((lang: any) => lang.code)
		: languages.allLang.map((lang: any) => lang.code);

	let paths: { params: { lang: string; slug: string } }[] = [];

	for (const lang of allLang) {
		// Use the API function to get all pages
		const pages = await getAllPages(lang);

		paths.push(
			...pages.map((item) => ({
				params: {
					lang: lang,
					slug: item.uri,
				},
			}))
		);
	}

	return paths;
}

const { lang, slug } = Astro.params;
const global = await getData<GlobalData>(`/${lang}/global.json`);
---

<PageRenderer slug={slug} lang={lang} global={global} />
