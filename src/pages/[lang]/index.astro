---
import rootIndex from '@public/content/index.json';
import PageRenderer from '@components/PageRenderer.astro';
import { getPage, getData, type GlobalData } from '@lib/api';

export async function getStaticPaths() {
	// Extract languages from the pages
	const languages = new Set<string>();

	// Process all pages to find available languages
	rootIndex.forEach((page) => {
		if (page.translations) {
			Object.keys(page.translations).forEach((lang) => {
				languages.add(lang);
			});
		}
	});

	// Generate paths for all languages
	return Array.from(languages).map((lang) => ({
		params: {
			lang,
		},
		props: {
			lang,
		},
	}));
}

const { lang } = Astro.props;

// Use API functions to get data
const pageData = await getPage('home', lang);
const globalData = await getData<GlobalData>(`/${lang}/global.json`);
---

<PageRenderer slug="home" lang={lang} data={pageData} global={globalData} />
