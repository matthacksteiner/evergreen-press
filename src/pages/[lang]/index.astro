---
import rootIndex from '@public/content/index.json';
import PageRenderer from '@components/PageRenderer.astro';
import { getPage, getData } from '@lib/api';
import type { GlobalData } from '@types';

interface PageEntry {
	id: string;
	uri: string;
	intendedTemplate: string;
	parent: string | null;
	coverOnly: boolean | null;
	translations: Record<string, string>;
}

export async function getStaticPaths() {
	// Load the root index which contains all pages
	const pages = rootIndex as PageEntry[];

	// Extract languages from the pages
	const languages = new Set<string>();

	// Process all pages to find available languages
	pages.forEach((page) => {
		if (page.translations) {
			Object.keys(page.translations).forEach((lang) => {
				languages.add(lang);
			});
		}
	});

	// Generate paths for all languages
	return Array.from(languages).map((lang) => ({
		params: {
			lang,
		},
		props: {
			lang,
		},
	}));
}

const { lang } = Astro.props;

// Use API functions to get data
const pageData = await getPage('home', lang);
const globalData = await getData<GlobalData>(`/${lang}/global.json`);
---

<PageRenderer slug="home" lang={lang} data={pageData} global={globalData} />
