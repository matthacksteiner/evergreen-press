---
const { lang } = Astro.params;
import { getData, getLanguages } from '@lib/api.js';
import BaseLayout from '@layouts/BaseLayout.astro';
import Layouts from '@components/Layouts.astro';

export async function getStaticPaths() {
	const API_URL = import.meta.env.KIRBY_URL;
	const global = await getData(`/global.json`);
	const prefixDefaultLocale = global.prefixDefaultLocale;
	const pagesResponse = await fetch(API_URL + '/index.json');
	const data = await pagesResponse.json();
	const languages = await getLanguages();
	const allLang = !prefixDefaultLocale
		? languages.translations.map(({ code }) => code)
		: languages.allLang.map(({ code }) => code);
	return data.flatMap((item) => {
		return allLang.map((lang) => {
			return {
				params: {
					lang: lang,
					slug: item.uri,
				},
			};
		});
	});
}
const currentLang = lang;
const data = await getData(`/${currentLang}/home.json`);
const global = await getData(`/${currentLang}/global.json`);
const pageTitle = data.title;
---

<BaseLayout pageTitle={pageTitle} data={data} global={global}>
	<Layouts layouts={data.layouts} data={data} global={global} />
</BaseLayout>
