---
export const prerender = false;

import { getData, getGlobal, type PageData, type GlobalData } from '@lib/api';
import BaseLayout from '@layouts/BaseLayout.astro';
import Layouts from '@components/Layouts.astro';

// Set environment variable for preview mode detection
process.env.ASTRO_PATH = Astro.url.pathname;

let data: PageData;
let global: GlobalData;
let pageTitle = 'Page Not Found';

try {
	data = await getData<PageData>(`/error.json`);
	global = await getGlobal();
	pageTitle = data.title || 'Page Not Found';
} catch (error) {
	console.error('Error in preview 404 page:', error);

	// Provide fallback data if API request fails
	data = {
		title: 'Page Not Found',
		uri: 'error',
		intendedTemplate: 'error',
		layouts: [
			{
				type: 'error',
				content: {
					text: 'The requested page could not be found in preview mode.',
				},
			},
		],
	};

	global = {
		translations: {},
		defaultLang: 'en',
		allLang: ['en'],
		prefixDefaultLocale: false,
		frontendUrl: '',
		fontSize: [],
	};
}
---

<BaseLayout pageTitle={pageTitle} data={data} global={global}>
	<Layouts layouts={data.layouts} data={data} global={global} />
	<div
		class="fixed bottom-4 right-4 z-40 rounded-lg bg-red-600 px-3 py-1 font-medium text-white shadow-md"
	>
		Preview Mode
	</div>
</BaseLayout>
