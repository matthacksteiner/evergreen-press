---
const {
	items,
	titleFont,
	titleColor,
	titleSize,
	titleAlign,
	textFont,
	textColor,
	textSize,
	textAlign,
	controls,
	color,
	time,
} = Astro.props;
const hasControl = (control) => controls && controls.includes(control);
const arrows = hasControl('arrows');
const dots = hasControl('dots');
const autoplay = hasControl('autoplay');
---

<sections
	class={`blocks blockQuoteSlider`}
	data-controls={controls}
	data-time={time}
>
	<div class="swiper swiperSlider">
		<div class="swiper-wrapper items-center">
			{
				items?.map((item) => (
					<div class={`swiper-slide`}>
						<blockquote>
							<div
								set:html={item.text}
								class={`quote kirby-text font--${textSize} text--${textColor} text--${textAlign} pt-4`}
							/>
						</blockquote>
						<p>
							<div
								set:html={item.author}
								class={`author kirby-text font--${titleSize} text--${titleColor} text--${titleAlign} pt-4`}
							/>
						</p>
					</div>
				))
			}
		</div>
	</div>
	<div class="swiper-controls">
		{dots && <div class={`swiper-pagination swiper-pagination--${color}`} />}
		{
			arrows && (
				<nav class="swiper-nav">
					<button class={`text--${color} swiper-left`}>&#10094;</button>
					<button class={`text--${color} swiper-right`}>&#10095;</button>
				</nav>
			)
		}
	</div>
</sections>

<script>
	import Swiper, { Navigation, Autoplay, Pagination, EffectFade } from 'swiper';
	import 'swiper/css/bundle';
	import 'swiper/css/effect-fade';
	Swiper.use([Navigation, Autoplay, Pagination, EffectFade]);

	const blockQuoteSliders = document.querySelectorAll('.blockQuoteSlider');

	blockQuoteSliders.forEach((blockQuoteSlider) => {
		if (blockQuoteSlider instanceof HTMLElement) {
			const controls = blockQuoteSlider?.dataset.controls;
			const time = blockQuoteSlider?.dataset.time;
			const autoplay = controls?.includes('autoplay');
			if (time) {
				const swiperSlider = blockQuoteSlider.querySelector('.swiperSlider');
				const swiper = new Swiper(swiperSlider, {
					...(autoplay && {
						autoplay: {
							delay: parseInt(time),
						},
					}),
					centeredSlidesBounds: true,
					loop: true,
					navigation: {
						nextEl: blockQuoteSlider.querySelector('.swiper-right'),
						prevEl: blockQuoteSlider.querySelector('.swiper-left'),
					},
					pagination: {
						el: blockQuoteSlider.querySelector('.swiper-pagination'),
						type: 'bullets',
						clickable: true,
					},
				});
			}
		}
	});
</script>

<style lang="css" define:vars={{ titleFont, textFont }}>
	.swiper-controls {
		@apply mt-4 flex h-24 flex-col justify-between;
	}
	.swiper-nav {
		@apply flex justify-center gap-8 text-4xl;
	}

	.swiper-pagination {
		@apply relative bottom-auto top-auto;
	}

	.author {
		font-family: var(--titleFont);
	}
	.quote {
		font-family: var(--textFont);
	}
	.swiper-pagination--primary .swiper-pagination-bullet-active,
	.swiper-pagination--primary .swiper-pagination-progressbar-fill {
		@apply bg-primary;
	}

	.swiper-pagination--secondary .swiper-pagination-bullet-active,
	.swiper-pagination--secondary .swiper-pagination-progressbar-fill {
		@apply bg-secondary;
	}

	.swiper-pagination--tertiary .swiper-pagination-bullet-active,
	.swiper-pagination--tertiary .swiper-pagination-progressbar-fill {
		@apply bg-tertiary;
	}

	.swiper-pagination--black .swiper-pagination-bullet-active,
	.swiper-pagination--black .swiper-pagination-progressbar-fill {
		@apply bg-black;
	}

	.swiper-pagination--white .swiper-pagination-bullet-active,
	.swiper-pagination--white .swiper-pagination-progressbar-fill {
		@apply bg-white;
	}

	.swiper-pagination--transparent .swiper-pagination-bullet-active,
	.swiper-pagination--transparent .swiper-pagination-progressbar-fill {
		@apply bg-transparent;
	}
</style>
