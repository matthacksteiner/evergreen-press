---
import { Image } from 'astro:assets';
const { image, widthMobile, widthDesktop, noLink, widthAlign } = Astro.props;
const classes = image?.classes;
const link = image?.linkexternal;
const imageProps = {
	src: image?.url,
	alt: image?.alt,
	width: image?.width,
	height: image?.height,
	id: image?.identifier,
	'class:list': [
		`widthMobile--${widthMobile || '100'}`,
		`widthDesktop--${widthDesktop || '100'}`,
		widthAlign === 'start' || widthAlign === 'normal'
			? 'mr-auto'
			: widthAlign === 'center'
			? 'mx-auto'
			: widthAlign === 'end' && 'ml-auto',
		classes,
	].filter(Boolean),
};
---

{
	() => {
		if (!image) return null;

		if (!image.linktoggle || noLink) {
			return <Image {...imageProps} />;
		}

		if (!link) return null;

		let href, target, rel;

		switch (link.type) {
			case 'url':
				href = link.href;
				target = link.popup ? '_blank' : undefined;
				rel = link.popup ? 'noopener' : undefined;
				break;

			case 'page':
				href = link.hash ? `${link.uri}#${link.hash}` : `${link.uri}`;
				break;

			case 'file':
				href = image.url;
				target = link.popup ? '_blank' : undefined;
				rel = link.popup ? 'noopener' : undefined;
				break;

			default:
				return null;
		}

		// Render image wrapped in link
		return (
			<a href={href} target={target} rel={rel}>
				<Image {...imageProps} />
			</a>
		);
	}
}

<style lang="css">
	.widthMobile {
		&--auto {
			@apply w-auto;
		}
		&--5 {
			@apply w-[5%];
		}
		&--10 {
			@apply w-[10%];
		}
		&--20 {
			@apply w-1/5;
		}
		&--33 {
			@apply w-1/3;
		}
		&--50 {
			@apply w-1/2;
		}
		&--66 {
			@apply w-2/3;
		}
		&--75 {
			@apply w-3/4;
		}
		&--100 {
			@apply w-full;
		}
	}

	@media (min-width: 768px) {
		.widthDesktop {
			&--auto {
				@apply w-auto;
			}
			&--5 {
				@apply w-[5%];
			}
			&--10 {
				@apply w-[10%];
			}
			&--20 {
				@apply w-1/5;
			}
			&--33 {
				@apply w-1/3;
			}
			&--50 {
				@apply w-1/2;
			}
			&--66 {
				@apply w-2/3;
			}
			&--75 {
				@apply w-3/4;
			}
			&--100 {
				@apply w-full;
			}
		}
	}
</style>
